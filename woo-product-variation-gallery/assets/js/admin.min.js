!function(e){"use strict";function t(){e(document.body).trigger("init_tooltips")}function i(){e(document).off("click",".rtwpvg-add-image"),e(document).off("click",".rtwpvg-gallery-edit"),e(document).off("click",".rtwpvg-media-video-popup"),e(document).on("click",".rtwpvg-add-image",a),e(document).on("click",".rtwpvg-remove-image",r),e(document).on("click",".rtwpvg-gallery-edit",o),e(document).on("click",".rtwpvg-media-video-popup",n),e(".woocommerce_variation").each((function(){var t=e(this).find(".options");e(this).find(".rtwpvg-gallery-wrapper").insertBefore(t)}))}function a(t){t.preventDefault(),t.stopPropagation();var i=this,a=0,n=e(this).data("product_variation_id"),o=e(this).data("product_variation_loop"),r=e(this).parents(".rtwpvg-gallery-wrapper").find("input").map((function(){return Number(e(this).val())})).get();if(console.log(r),"undefined"!=typeof wp&&wp.media&&wp.media.editor){if(a)return void a.open();(a=wp.media.frames.select_image=wp.media({title:rtwpvg_admin.choose_image,button:{text:rtwpvg_admin.add_image},library:{type:["image"]},multiple:!0})).on("select",(function(){var t=a.state().get("selection").toJSON().map((function(e){if("image"===e.type){if(console.log(e),-1===r.indexOf(e.id)){var t=e.id,i=e.rtwpvg_video_link,a=e.sizes,l=(a=void 0===a?{}:a).thumbnail,d=a.full,s=l?l.url:d.url;return wp.template("rtwpvg-image")({id:t,url:s,product_variation_id:n,loop:o,rtwpvg_video_link:i})}alert("Cannot add duplicate items.")}})).join("");e(i).parent().prev().find(".rtwpvg-images").append(t),d(),l(i)})),a.open()}}function n(t){var i;t.preventDefault(),t.stopPropagation();var a=e(t.currentTarget).parents("li.image"),n=a.find("input").val();if(n){var o=wp.media.attachment(n),r=(null===(i=rtwpvg_admin)||void 0===i?void 0:i.pro_version)||null,l="2.3.12",d=r&&function(e,t){for(var i=e.split(".").map(Number),a=t.split(".").map(Number),n=0;n<Math.max(i.length,a.length);n++){var o=i[n]||0,r=a[n]||0;if(o>r)return!0;if(o<r)return!1}return!0}(r,l);o.fetch().done((function(){var t=o.toJSON(),i=(null==t?void 0:t.rtwpvg_video_link)||"",r=(null==t?void 0:t.rtwpvg_video_width)||"",s=(null==t?void 0:t.rtwpvg_video_height)||"",p='\n            <div class="custom-edit-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999999; display: flex; align-items: center; justify-content: center;">\n                <div class="modal-inner-wrapper" style="background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">\n                    <div class="modal-form-section" >\n                        <h2 style="margin-top:0">Poster Image</h2>\n                        <hr/>\n                        <div class="image-wrap" style="display: flex;justify-content: center;"><img src="'.concat(t.url,'" style="max-width: 250px; height: auto; margin-bottom: 20px;"></div>\n                        ').concat(d?"":'\n                        <div style="background: #fef7e0; border: 1px solid #e0c97d; color: #7a6000; padding: 10px 15px; border-radius: 6px; margin-bottom: 15px;">\n                            Video options are available in the <a href="https://www.radiustheme.com/downloads/woocommerce-variation-images-gallery/" style="color: red;font-size: 16px" target="_blank"><strong>Pro version</strong></a> <br/> (minimum version '.concat(l,")\n                        </div>\n                        "),'\n                        <label style="display: block; margin-bottom: 15px;">\n                            <strong>Video Url: </strong>\n                            <input ').concat(d?"":"disabled",' type="text" id="rtwpvg_video_link" value="').concat(i,'" placeholder="https://www.youtube.com/watch?v=zQKKUx2ECa8" style="width: 100%; padding: 8px; margin-top: 5px;">\n                            <p class="help">You can add a YouTube, Vimeo, TikTok, or uploaded video. <b>Example: https://www.youtube.com/watch?v=zQKKUx2ECa8</b> <br/> <a href="').concat(rtwpvg_admin.admin_url,'upload.php?mode=grid&attachment-filter=post_mime_type%3Avideo" target="_blank">Upload your video <span class="dashicons dashicons-video-alt3"></span></a></p>\n                        </label>\n                        <label style="display: block; margin-bottom: 15px;">\n                            <strong>Video Width: </strong>\n                            <input ').concat(d?"":"disabled",' type="text" id="rtwpvg_video_width" value="').concat(r,'" style="width: 100%; padding: 8px; margin-top: 5px;">\n                            <p class="help">Video Width. px or %. Empty for default. <b>Example: 575px</b> </p>\n                        </label>\n                        <label style="display: block; margin-bottom: 15px;">\n                            <strong>Video Height: </strong>\n                            <input ').concat(d?"":"disabled",' type="text" id="rtwpvg_video_height" value="').concat(s,'" style="width: 100%; padding: 8px; margin-top: 5px;">\n                            <p class="help">Video Height. px or %. Empty for default. <b>Example: 550px</b></p>\n                        </label>\n                    </div>\n                     <hr/>\n                    <div style="text-align: right;margin-top:15px">\n                        <button class="button" id="cancel-edit" style="margin-right: 10px;">Cancel</button>\n                        <button class="button button-primary" id="save-edit">Update</button>\n                    </div>\n                </div>\n            </div>');e("body").append(p),e("#cancel-edit").on("click",(function(){e(".custom-edit-modal").remove()})),e("#save-edit").on("click",(function(){var t,i=e("body").find("#rtwpvg_video_link"),o=e("body").find("#rtwpvg_video_width"),r=e("body").find("#rtwpvg_video_height");i.length&&o.length&&r.length?null!==(t=rtwpvg_admin)&&void 0!==t&&t.pro_version?e.ajax({url:ajaxurl,type:"POST",data:{action:"rtwpvg_update_attachment_video_meta",attachment_id:n,video_link:i.val(),video_width:o.val(),video_height:r.val(),_wpnonce:rtwpvg_admin.nonce||""},success:function(t){var i,n,o;null!=t&&null!==(i=t.data)&&void 0!==i&&i.hasVideo?a.addClass("video"):a.removeClass("video"),e("body").find(".modal-inner-wrapper").html(null==t||null===(n=t.data)||void 0===n?void 0:n.message),null!=t&&t.success&&setTimeout((function(){e("body").find(".custom-edit-modal").remove()}),800),console.log(null==t||null===(o=t.data)||void 0===o?void 0:o.message)}}):alert("It's Pro Feature"):alert("Required video fields are missing. Please reload the page.")}))})).fail((function(){console.error("Failed to load attachment")}))}}function o(t){t.preventDefault(),t.stopPropagation();var i=e(t.currentTarget).parents("li.image"),a=i.find("input"),n=a.val(),o=wp.media({title:"Edit Image",button:{text:"Update Image"},library:{type:"image"},multiple:!1});o.on("open",(function(){if(n){var e=o.state().get("selection"),t=wp.media.attachment(n);t.fetch(),e.add(t)}})),o.on("select",(function(){var e,t=o.state().get("selection").first().toJSON(),n=(null===(e=t.sizes)||void 0===e||null===(e=e.thumbnail)||void 0===e?void 0:e.url)||t.url,r=i.find("img");null!=t&&t.rtwpvg_video_link?i.addClass("video"):i.removeClass("video"),r.length&&r.attr("src",n),a.val(t.id)})),o.open(),l(this)}function r(t){t.preventDefault(),t.stopPropagation();var i=this;l(this),setTimeout((function(){e(i).parents("li.image").remove()}),1)}function l(t){e(t).closest(".woocommerce_variation").addClass("variation-needs-update"),e("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),e("#variable_product_options").trigger("woocommerce_variations_input_changed")}function d(){e(".rtwpvg-images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"rtwpvg-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){l(this)}})}function s(){"grid"==e("#thumbnail_position-field").val()?(e("#thumbnail_slide-wrapper").hide(),e("#slider_arrow-wrapper").hide(),e("#slider_adaptive_height-wrapper").hide()):(e("#thumbnail_slide-wrapper").show(),e("#slider_arrow-wrapper").show(),e("#slider_adaptive_height-wrapper").show())}e.fn.wpColorPicker&&e("input.rtwpvg-color-picker").wpColorPicker(),e("#rtwpvg-settings-wrapper").on("click",".nav-tab",(function(t){t.preventDefault();var i=e(this),a=i.data("target");if(i.addClass("nav-tab-active").siblings().removeClass("nav-tab-active"),e("#"+a).show().siblings().hide(),e("#_last_active_tab").val(a),history.pushState){var n=function(e,t){var i=window.location.href,a=location.hash;if((i=i.replace(a,"")).indexOf("?")>=0){var n=i.substring(i.indexOf("?")+1).split("&"),o=!1;n.forEach((function(i,a){i.split("=")[0]==e&&(n[a]=e+"="+t,o=!0)})),o||n.push(e+"="+t),i=i.substring(0,i.indexOf("?")+1)+n.join("&")}else i+="?"+e+"="+t;return i+a}("section",a);window.history.pushState({path:n},"",n)}})),e(".rtwpvg-setting-tab #license_key-wrapper").on("keyup","#license_key-field",(function(t){t.preventDefault(),e(".license-status").html("When add license key first click on Save changes")})),e(".rtwpvg-setting-tab #license_key-wrapper").on("click",".rt-licensing-btn",(function(t){t.preventDefault(),console.log("clicked");var i=e(this),a=i.hasClass("license_activate")?"license_activate":"license_deactivate";e.ajax({type:"POST",url:rtwpvg_admin.ajaxurl,data:{action:"rtwpvg_manage_licensing",type:a},beforeSend:function(){i.addClass("loading"),i.parents(".description").find(".rt-licence-msg").remove(),e('<span class="rt-icon-spinner animate-spin"></span>').insertAfter(i)},success:function(t){i.next(".rt-icon-spinner").remove(),i.removeClass("loading"),t.error||(i.text(t.value),i.removeClass(a),i.addClass(t.type),"license_deactivate"==t.type?(i.removeClass("button-primary"),i.addClass("danger")):"license_activate"==t.type&&(i.removeClass("danger"),i.addClass("button-primary"))),t.msg&&e("<span class='rt-licence-msg'>"+t.msg+"</span>").insertAfter(i),i.blur()},error:function(e,t){i.removeClass("loading"),i.next(".rt-icon-spinner").remove()}})})),e("#woocommerce-product-data").on("woocommerce_variations_loaded",(function(){i(),d()})),e("#variable_product_options").on("woocommerce_variations_added",(function(){i(),d()})),e("#woocommerce-product-images .add_product_images").on("click","a",(function(e){})),e((function(){function i(){e("#preloader-field").is(":checked")?e("#preloader_image-wrapper").show():e("#preloader_image-wrapper").hide()}e("#rtwpvg-settings-wrapper").on("click",".pro-field",(function(t){t.preventDefault(),e(".rtvg-pro-alert").show()})),e(".rtvg-pro-alert-close").on("click",(function(t){t.preventDefault(),e(".rtvg-pro-alert").hide()})),i(),e(document).on("change","#preloader-field",(function(){i()})),e(document).on("click",".rtwpvg-upload-box",(function(t){t.preventDefault();var i,a,n=e(this).attr("data-name"),o=e(this).attr("data-field"),r=e(this);void 0===i?((i=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",multiple:"image"!=o})).on("insert",(function(){if(a=i.state().get("selection").first().toJSON(),!(0>e.trim(a.url.length))){var t=i.state().get("selection").toJSON(),l="",d="image"==o?"":"[]";t.forEach((function(e){l+="<div class='rtwpvg-preview-img'><img src='"+e.url+"' /><input type='hidden' name='"+n+d+"' value='"+e.id+"'><button class='rtwpvg-file-remove' data-id='"+e.id+"'>x</button></div>"})),r.prev().html(l)}})),i.open()):i.open()})),e(document).on("click",".rtwpvg-file-remove",(function(t){t.preventDefault(),confirm(rtwpvg_admin.sure_txt)&&(e(this).parent().parent().children(".rtwpvg-preview-img").length<=1?(e(this).parent().children("img").remove(),e(this).parent().children("input").val(0),e(this).remove()):e(this).parent().remove(),e("button.woocommerce-save-button").removeAttr("disabled"))})),s(),e("#thumbnail_position-field").on("change",(function(e){e.preventDefault(),s()})),e("#woocommerce-product-data").on("woocommerce_variations_loaded woocommerce_variations_added",(function(){t()})),t()}))}(jQuery);
